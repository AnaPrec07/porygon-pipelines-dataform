config {
  type: "table",
  schema: "s_thelook",
  description: "Cleaned version of raw products table",
  columns: {
    product_id: docs.product_id,
    cost: docs.cost,
    category: docs.category,
    brand: docs.brand,
    retail_price: docs.retail_price,
    markup: docs.markup,
    department: docs.department,
    processed_at: docs.processed_at,
  }
  tags: ["staging"],
  assertions: {
    nonNull: ["product_id"],
    uniqueKey: ["product_id"],
    ${assertions.runtimeTimestampAssertion()},
  }
}

SELECT 
  id AS product_id,
  cost,
  category,
  brand,
  retail_price,
  retail_price - cost AS markup,
  department,
  ${date_functions.getRuntimeTimestamp()}
FROM ${ref("products")}